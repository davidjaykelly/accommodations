/**
 * Admin functionality for accommodations.
 *
 * @module     local_accommodations/accommodation_admin
 * @copyright  2025 Your Name <your.email@example.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_accommodations/accommodation_admin",["jquery","core/modal_factory","core/modal_events","core/str","core/ajax","core/notification"],(function($,ModalFactory,ModalEvents,Str,Ajax,Notification){function updateBulkActionButtons(){var selectedCount=$(".accommodation-checkbox:checked").length;selectedCount>0?($(".bulk-action-button").removeClass("disabled"),$(".bulk-action-button").each((function(){var originalText=$(this).data("original-text")||$(this).text();$(this).data("original-text")||$(this).data("original-text",originalText),$(this).text(originalText+" ("+selectedCount+")")}))):($(".bulk-action-button").addClass("disabled"),$(".bulk-action-button").each((function(){var originalText=$(this).data("original-text");originalText&&$(this).text(originalText)})))}return{init:function(){$(document).on("click",".delete-accommodation",(function(e){e.preventDefault();var deleteUrl=$(this).attr("href"),typeName=$(this).data("type"),userName=$(this).data("user");Str.get_string("confirmdelete","local_accommodations",{type:typeName,user:userName}).then((function(confirmText){return ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:Str.get_string("confirm","moodle"),body:confirmText})})).then((function(modal){return modal.setSaveButtonText(Str.get_string("delete","moodle")),modal.getRoot().on(ModalEvents.save,(function(){window.location.href=deleteUrl})),modal.show(),modal})).catch(Notification.exception)})),$("#select-all-accommodations").on("change",(function(){var checked=$(this).prop("checked");$(".accommodation-checkbox").prop("checked",checked),updateBulkActionButtons()})),$(document).on("change",".accommodation-checkbox",(function(){updateBulkActionButtons();var allChecked=$(".accommodation-checkbox:checked").length===$(".accommodation-checkbox").length;$("#select-all-accommodations").prop("checked",allChecked)})),$(".bulk-action-button").on("click",(function(e){e.preventDefault();var action=$(this).data("action"),selectedIds=function(){var selectedIds=[];return $(".accommodation-checkbox:checked").each((function(){selectedIds.push($(this).val())})),selectedIds}();0!==selectedIds.length?function(action,ids){Ajax.call([{methodname:"local_accommodations_bulk_action",args:{action:action,ids:ids}}])[0].then((function(result){result.success?(Notification.addNotification({message:result.message,type:"success"}),window.location.reload()):Notification.addNotification({message:result.message,type:"error"})})).catch(Notification.exception)}(action,selectedIds):Str.get_string("noselecteditems","moodle").then((function(message){Notification.addNotification({message:message,type:"info"})})).catch(Notification.exception)})),$(document).on("click",".category-tree .has-children > .category-link",(function(e){e.preventDefault();var li=$(this).parent();li.toggleClass("expanded");var ul=li.find("> ul");li.hasClass("expanded")?ul.slideDown():ul.slideUp()})),$("#batch-apply-button").on("click",(function(){var activityType=$("#batch-activity-type").val(),checked="enable"===$("#batch-action").val();$("all"===activityType?".activity-toggle":'.activity-toggle[data-type="'+activityType+'"]').prop("checked",checked).trigger("change");var messageKey=checked?"enabledallaccommodations":"disabledallaccommodations";Str.get_string(messageKey,"local_accommodations").then((function(message){Notification.addNotification({message:message,type:"success"})})).catch(Notification.exception)})),$("#accommodations-csv-file").on("change",(function(){var file=this.files[0];if(file){var reader=new FileReader;reader.onload=function(e){for(var lines=e.target.result.split("\n"),preview="",i=0;i<Math.min(5,lines.length);i++)preview+=lines[i]+"\n";$("#csv-preview").text(preview)},reader.readAsText(file)}}))}}}));

//# sourceMappingURL=accommodation_admin.min.js.map