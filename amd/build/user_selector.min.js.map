{"version":3,"file":"user_selector.min.js","sources":["../src/user_selector.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * User selector for accommodations.\n *\n * @module     local_accommodations/user_selector\n * @copyright  2025 Your Name <your.email@example.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/str', 'core/notification'], function($, Ajax, Str, Notification) {\n    /**\n     * Initialize the user selector.\n     */\n    var init = function() {\n        // Elements\n        var searchInput = $('#accommodation-user-search');\n        var resultsContainer = $('#accommodation-user-results');\n        var selectedUserField = $('#accommodation-selected-userid');\n\n        if (searchInput.length === 0) {\n            return;\n        }\n\n        // Minimum search length\n        var minLength = 3;\n\n        // Get course and category context\n        var courseId = $('input[name=\"courseid\"]').val() || 0;\n        var categoryId = $('input[name=\"categoryid\"]').val() || 0;\n\n        // Handle search input\n        searchInput.on('keyup', function() {\n            var searchTerm = $(this).val().trim();\n\n            // Clear results if search term is too short\n            if (searchTerm.length < minLength) {\n                resultsContainer.empty();\n                return;\n            }\n\n            // Get search results\n            searchUsers(searchTerm, courseId, categoryId).then(function(users) {\n                displayResults(users);\n            }).catch(Notification.exception);\n        });\n\n        /**\n         * Search for users.\n         *\n         * @param {string} searchTerm The search term\n         * @param {number} courseId Optional course ID\n         * @param {number} categoryId Optional category ID\n         * @return {Promise} Promise resolved with users array\n         */\n        function searchUsers(searchTerm, courseId, categoryId) {\n            var promises = Ajax.call([{\n                methodname: 'core_user_search_identity',\n                args: {\n                    query: searchTerm,\n                    courseid: courseId > 0 ? courseId : undefined,\n                    categoryId: courseId > 0 ? categoryId : undefined,\n                }\n            }]);\n\n            return promises[0];\n        }\n\n        /**\n         * Display search results.\n         *\n         * @param {Array} users Array of user objects\n         */\n        function displayResults(users) {\n            resultsContainer.empty();\n\n            if (users.length === 0) {\n                Str.get_string('nousersmatching', 'local_accommodations', searchInput.val()).then(function(message) {\n                    resultsContainer.html('<div class=\"alert alert-info\">' + message + '</div>');\n                    return;\n                }).catch(Notification.exception);\n            }\n\n            var resultsList = $('<ul class=\"list-group user-search-results\"></ul>');\n\n            users.forEach(function(user) {\n                var listItem = $('<li class=\"list-group-item user-result\" data-id=\"' + user.id + '\">' +\n                    '<img src=\"' + user.profileimageurlsmall + '\" class=\"user-picture mr-2\" alt=\"\" />' +\n                    user.fullname + ' (' + user.email + ')' +\n                    '</li>');\n                resultsList.append(listItem);\n            });\n\n            resultsContainer.append(resultsList);\n\n            // Handle user selection\n            $('.user-result').on('click', function() {\n                var userId = $(this).data('id');\n                var userName = $(this).text();\n\n                // Set the selected user ID\n                selectedUserField.val(userId);\n\n                // Update the search input with selected user name\n                searchInput.val(userName);\n\n                // Clear the results\n                resultsContainer.empty();\n\n                // Submit the form\n                searchInput.closest('form').submit();\n            });\n        }\n    };\n\n    return {\n        init: init\n    };\n});"],"names":["define","$","Ajax","Str","Notification","init","searchInput","resultsContainer","selectedUserField","length","courseId","val","categoryId","on","searchTerm","this","trim","empty","call","methodname","args","query","courseid","undefined","searchUsers","then","users","get_string","message","html","catch","exception","resultsList","forEach","user","listItem","id","profileimageurlsmall","fullname","email","append","userId","data","userName","text","closest","submit","displayResults"],"mappings":";;;;;;;AAuBAA,4CAAO,CAAC,SAAU,YAAa,WAAY,sBAAsB,SAASC,EAAGC,KAAMC,IAAKC,oBAyG7E,CACHC,KAtGO,eAEHC,YAAcL,EAAE,8BAChBM,iBAAmBN,EAAE,+BACrBO,kBAAoBP,EAAE,qCAEC,IAAvBK,YAAYG,YAQZC,SAAWT,EAAE,0BAA0BU,OAAS,EAChDC,WAAaX,EAAE,4BAA4BU,OAAS,EAGxDL,YAAYO,GAAG,SAAS,eAChBC,WAAab,EAAEc,MAAMJ,MAAMK,OAG3BF,WAAWL,OAXH,EAYRF,iBAAiBU,iBAkBJH,WAAYJ,SAAUE,mBACxBV,KAAKgB,KAAK,CAAC,CACtBC,WAAY,4BACZC,KAAM,CACFC,MAAOP,WACPQ,SAAUZ,SAAW,EAAIA,cAAWa,EACpCX,WAAYF,SAAW,EAAIE,gBAAaW,MAIhC,GAvBhBC,CAAYV,WAAYJ,SAAUE,YAAYa,MAAK,SAASC,iBA+BxCA,OACpBnB,iBAAiBU,QAEI,IAAjBS,MAAMjB,QACNN,IAAIwB,WAAW,kBAAmB,uBAAwBrB,YAAYK,OAAOc,MAAK,SAASG,SACvFrB,iBAAiBsB,KAAK,iCAAmCD,QAAU,aAEpEE,MAAM1B,aAAa2B,eAGtBC,YAAc/B,EAAE,oDAEpByB,MAAMO,SAAQ,SAASC,UACfC,SAAWlC,EAAE,oDAAsDiC,KAAKE,GAA3D,eACEF,KAAKG,qBAAuB,wCAC3CH,KAAKI,SAAW,KAAOJ,KAAKK,MAFf,UAIjBP,YAAYQ,OAAOL,aAGvB5B,iBAAiBiC,OAAOR,aAGxB/B,EAAE,gBAAgBY,GAAG,SAAS,eACtB4B,OAASxC,EAAEc,MAAM2B,KAAK,MACtBC,SAAW1C,EAAEc,MAAM6B,OAGvBpC,kBAAkBG,IAAI8B,QAGtBnC,YAAYK,IAAIgC,UAGhBpC,iBAAiBU,QAGjBX,YAAYuC,QAAQ,QAAQC,YAnE5BC,CAAerB,UAChBI,MAAM1B,aAAa2B"}